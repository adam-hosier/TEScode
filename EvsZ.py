import mass 
import numpy as np 
import pylab as plt 
from mass.off import ChannelGroup, getOffFileListFromOneFile, Channel, labelPeak, labelPeaks
import os 
#import ebit_util
import pandas as pd
import matplotlib.colors as mcolors
from scipy.stats import binned_statistic_2d
from scipy import stats
from fit_utils import MultiPeakGaussian
from lmfit import minimize, Parameters, report_fit, Model, Parameter
from lmfit.models import GaussianModel
from lmfit.models import SplitLorentzianModel 

xdat = np.arange(18, 93)

#energies in cm-1
ydat = [140095,
    157157.8,
    174217.1,
    191290,
    208387.2,
    225519.3,
    242695.6,
    259920.4,
    277204.4,
    294551.5,
    311966.7,
    329457.9,
    347028.7,
    364684.8,
    382431,
    400276.4,
    418221.3,
    436275.4,
    454438.7,
    472720.7,
    491127.2,
    509660.6,
    528328.5,
    547130.1,
    566074.5,
    585175,
    604428.3,
    623845.7,
    643431.1,
    663191,
    683120.9,
    703249.1,
    723561.9,
    744070.7,
    764768.9,
    785717,
    806857.6,
    828233.9,
    849833.5,
    871678.7,
    893768.8,
    916121.9,
    938728.8,
    961594.5,
    984707.9,
    1008155.2,
    1031870.5,
    1055917.4,
    1080307.2,
    1104844.7,
    1129988.8,
    1155245.8,
    1180735.3,
    1206917.8,
    1233268.2,
    1260051.7,
    1287068.5,
    1314672.2,
    1342562.4,
    1370845.3,
    1399575.7,
    1428702.9,
    1458176.3,
    1488149.2,
    1518511.8,
    1549260.6,
    1580557.1,
    1612033.3,
    1643736.1,
    1676270.3,
    1709055.3,
    1742362.1,
    1774385.8,
    1809911.5,
    1841739.8]

#energy uncertainties in cm-1
yunc = [2.7,
    3.2,
    4.1,
    4.7,
    5.2,
    5.5,
    5.9,
    6.2,
    6.6,
    7.1,
    7.5,
    7.9,
    8.6,
    9.3,
    10.2,
    10.8,
    11.8,
    12.7,
    13.8,
    14.9,
    16,
    17.4,
    18.5,
    20,
    21.5,
    23.4,
    25,
    26.4,
    28.7,
    29.8,
    31.8,
    33.9,
    35.8,
    39.9,
    42.5,
    42.8,
    48.4,
    47.8,
    50.6,
    53.4,
    56.4,
    59.5,
    62.7,
    76,
    87.6,
    86.9,
    93.2,
    99.7,
    135,
    137,
    151,
    133,
    145,
    154,
    167,
    180,
    223,
    214,
    230,
    250,
    275,
    175,
    170,
    175,
    186,
    199,
    464,
    508,
    557,
    614,
    685,
    739,
    324,
    893,
    332]

#fraction of nuclear contribution to total energy uncertainty
nucFrac = [0.001877333,
    0.006488281,
    0.001878049,
    0.016031915,
    0.003388846,
    0.0113,
    0.032640169,
    0.035616935,
    0.00223,
    0.029287887,
    0.019712,
    0.008128861,
    0.060717442,
    0.072150538,
    0.07872549,
    0.003483333,
    0.096016949,
    0.103503937,
    0.112789855,
    0.121442953,
    0.0938025,
    0.005474713,
    0.002990811,
    0.0095535,
    0.020751628,
    0.181452991,
    0.1958,
    0.12625,
    0.220383275,
    0.009597315,
    0.010308176,
    0.081769912,
    0.005868715,
    0.299122807,
    0.320941176,
    0.077462617,
    0.359318182,
    0.007985356,
    0.008456522,
    0.008981273,
    0.009498227,
    0.01007563,
    0.010684211,
    0.495723684,
    0.609143836,
    0.541772152,
    0.564753219,
    0.586960883,
    0.7788,
    0.75819708,
    0.784890066,
    0.671992481,
    0.707633793,
    0.716071429,
    0.734431138,
    0.754111111,
    0.827466368,
    0.779766355,
    0.803717391,
    0.81906,
    0.8236,
    0.314323429,
    0.196175294,
    0.034961143,
    0.036370968,
    0.188050251,
    0.892327586,
    0.902194882,
    0.911795332,
    0.91269544,
    0.903686131,
    0.923985115,
    0.187475309,
    0.931366181,
    0.111590361]


nonNuc = [2.699995242,
    3.199932643,
    4.09999277,
    4.699395959,
    5.199970141,
    5.499648841,
    5.89685629,
    6.196066197,
    6.599983589,
    7.096954226,
    7.498542747,
    7.899738986,
    8.584132949,
    9.275761909,
    10.16834259,
    10.79993448,
    11.74548045,
    12.63178886,
    13.71194033,
    14.78971635,
    15.9294532,
    17.39973924,
    18.49991726,
    19.99908729,
    21.49537023,
    23.0115511,
    24.51609624,
    26.18875925,
    27.99436327,
    29.79862755,
    31.79831045,
    33.78647682,
    35.79938349,
    38.07316345,
    40.25171301,
    42.67139701,
    45.16761139,
    47.79847597,
    50.59819069,
    53.39784625,
    56.39745584,
    59.49697975,
    62.69642122,
    66.00450269,
    69.47203523,
    73.04165661,
    76.91421699,
    80.71864469,
    84.68176283,
    89.32748665,
    93.56489118,
    98.49420986,
    102.4540095,
    107.4961598,
    113.3400966,
    118.214434,
    125.2179076,
    133.9791144,
    136.8525812,
    143.4269667,
    155.9720485,
    166.1302921,
    166.6967031,
    174.8930177,
    185.8769345,
    195.4497222,
    209.4442131,
    219.1149488,
    228.7292353,
    250.905249,
    293.3139093,
    282.6146128,
    318.2552583,
    325.1268612,
    329.9264247]


nonNuc2 = [2.699996068,
    3.199944333,
    4.099994024,
    4.699500798,
    5.199975323,
    5.499709788,
    5.897402012,
    6.196749102,
    6.599986438,
    7.097482926,
    7.498795679,
    7.899784287,
    8.586888838,
    9.27997306,
    10.17384391,
    10.79994585,
    11.75496065,
    12.64365355,
    13.72726393,
    14.80891539,
    15.94171925,
    17.39978449,
    18.49993162,
    19.99924569,
    21.49617381,
    23.07943673,
    24.60076218,
    26.22554289,
    28.11809915,
    29.79886575,
    31.79860368,
    33.80620653,
    35.79949049,
    38.39645166,
    40.65083025,
    42.69374432,
    45.7449877,
    47.79874048,
    50.59850471,
    53.39822005,
    56.3978974,
    59.49750394,
    62.69704235,
    67.84495191,
    72.94203109,
    75.62916104,
    79.97885658,
    84.31992647,
    95.3386784,
    99.25711612,
    105.7933385,
    105.2969017,
    111.0136395,
    116.9014008,
    124.3251785,
    131.0436568,
    146.9317444,
    150.94075,
    157.0324728,
    166.8777322,
    182.2914973,
    167.7033093,
    167.2746809,
    174.9115895,
    185.8982988,
    196.0704965,
    271.3282882,
    290.631687,
    311.5800218,
    342.719561,
    390.5604147,
    400.9868296,
    319.259693,
    475.1439677,
    330.287235]

figs, axs = plt.subplots(nrows=4, ncols=1, sharex=True)
axs[1].plot(xdat, yunc)
axs[0].set_title('Na-like Isoelectronic Sequence D1 Energies')
#axs[0].set_title('Na-like Isoelectronic Sequence D1 Energies')
axs[1].set_ylabel('Theoretical Uncertainty [cm-1]')

axs[2].plot(xdat, nonNuc)
axs[2].set_ylabel('QED error [cm-1]')



axs[3].plot(xdat, nucFrac)

axs[3].set_ylabel('Fractional Nuclear Contribution')

axs[0].scatter(xdat, ydat)
axs[0].errorbar(xdat, ydat, yerr=yunc, ls='none')
axs[0].set_ylabel('Energy [cm-1]')
axs[3].set_xlabel('Z')
plt.minorticks_on()
plt.show()
# plt.figure() 
# plt.scatter(xdat, ydat)
# plt.errorbar(xdat, ydat, yerr=yunc, ls='none')
# plt.legend()
# plt.ylabel('Energy [cm-1]')
# plt.xlabel('Z')
# plt.minorticks_on()
# plt.show()
# plt.close() 